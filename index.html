<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interaktive Rom-Karte — Version 4</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        display: flex;
        height: 100vh;
        flex-direction: row;
    }

    #map {
        flex: 3;
        position: relative;
    }

    #coords-display {
        position: absolute;
        bottom: 10px;
        left: 10px;
        background: rgba(255,255,255,0.85);
        padding: 6px 10px;
        border-radius: 4px;
        font-size: 14px;
        border: 1px solid #aaa;
        z-index: 1000;
    }

    #sidebar {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        background: #f5f5f5;
        border-left: 2px solid #ccc;
    }

    .info-box {
        padding: 8px;
        background: white;
        border-radius: 6px;
        border: 1px solid #aaa;
        width: 240px;
    }

    .marker-icon img {
        width: 32px;
        height: 32px;
        transition: transform 0.2s ease, filter 0.2s ease;
    }

    .marker-icon img:hover {
        transform: scale(1.35);
        filter: drop-shadow(0 0 6px rgba(0,0,0,0.4));
    }

    .leaflet-tooltip.hover-popup {
        background: white;
        border: 1px solid #aaa;
        border-radius: 6px;
        padding: 4px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
</style>
</head>

<body>

<div id="map">
    <div id="coords-display">Koordinaten: –</div>
</div>

<div id="sidebar">
    <h3>Filter</h3>

    <label><input type="checkbox" class="filter-symbol" value="tempel" checked> Tempel</label><br>
    <label><input type="checkbox" class="filter-symbol" value="thermen" checked> Thermen</label><br>
    <label><input type="checkbox" class="filter-symbol" value="strassen" checked> Straßen</label><br>
    <label><input type="checkbox" class="filter-symbol" value="foren" checked> Foren</label><br>
    <label><input type="checkbox" class="filter-symbol" value="kaiserzeit" checked> Kaiserzeit</label><br>
    <label><input type="checkbox" class="filter-symbol" value="republik" checked> Republik</label><br>
    <label><input type="checkbox" class="filter-symbol" value="sonstiges" checked> Sonstiges</label><br>

    <h4>Zeitauswahl</h4>
    <select id="time-filter"></select>

    <h4>Zeitleiste</h4>
    <input type="range" id="time-slider" min="" max="" value="" step="1" style="width:100%;">
    <div id="slider-label"></div>

    <h4>Admin</h4>
    <label>
        <input type="checkbox" id="admin-mode">
        Admin-Modus aktivieren
    </label>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// ------------------------------------------------------------
// 1. Karte
// ------------------------------------------------------------
const map = L.map('map').setView([41.8933, 12.4829], 15);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
}).addTo(map);

// ------------------------------------------------------------
// 2. Koordinatenanzeige
// ------------------------------------------------------------
const coordsDisplay = document.getElementById('coords-display');

map.on('mousemove', e => {
    coordsDisplay.textContent =
        `Koordinaten: ${e.latlng.lat.toFixed(5)}, ${e.latlng.lng.toFixed(5)}`;
});

// ------------------------------------------------------------
// 3. Zeitfunktion
// ------------------------------------------------------------
function yearToDecimal(year, month = 1, day = 1) {
    return year + (month - 1) / 12 + (day - 1) / 365;
}

// ------------------------------------------------------------
// 4. Papstliste (korrigiert)
// ------------------------------------------------------------
const popes = [
  { name: "Petrus", start: 30, end: 64 },
  { name: "Linus", start: 64, end: 76 },
  { name: "Johannes Paul II.", start: 1978, end: 2005 },
  { name: "Franziskus", start: 2013, end: 2025 },
  { name: "Leo XIV.", start: 2025, end: new Date().getFullYear() }
];

// ------------------------------------------------------------
// 5. Icons
// ------------------------------------------------------------
function makeIcon(url) {
    return L.divIcon({
        className: "marker-icon",
        html: `<img src="${url}" alt="">`,
        iconSize: [32, 32],
        iconAnchor: [16, 16]
    });
}

const icons = {
    tempel: makeIcon('https://cdn-icons-png.flaticon.com/512/3176/3176298.png'),
    thermen: makeIcon('https://cdn-icons-png.flaticon.com/512/854/854878.png'),
    strassen: makeIcon('https://cdn-icons-png.flaticon.com/512/684/684908.png'),
    foren: makeIcon('https://cdn-icons-png.flaticon.com/512/3176/3176298.png'),
    kaiserzeit: makeIcon('https://cdn-icons-png.flaticon.com/512/1998/1998592.png'),
    republik: makeIcon('https://cdn-icons-png.flaticon.com/512/1998/1998584.png'),
    sonstiges: makeIcon('https://cdn-icons-png.flaticon.com/512/1828/1828884.png')
};

// ------------------------------------------------------------
// 6. Marker-Daten (Version 1.0)
// ------------------------------------------------------------
const points = [
    {
        coords: [41.8902, 12.4922],
        title: "Kolosseum",
        date: "80 n. Chr. – heute",
        startValue: yearToDecimal(80),
        endValue: new Date().getFullYear(),
        text: "Das größte Amphitheater der Antike.",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/de/Colosseo_2020.jpg/320px-Colosseo_2020.jpg",
        symbol: "kaiserzeit"
    },
    {
        coords: [41.8925, 12.4853],
        title: "Forum Romanum",
        date: "7.–5. Jh. v. Chr.",
        startValue: -700,
        endValue: -401,
        text: "Politisches Zentrum der frühen römischen Geschichte.",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Forum_Romanum_Rome_Italy.jpg/320px-Forum_Romanum_Rome_Italy.jpg",
        symbol: "foren"
    },
    {
        coords: [41.9031, 12.4958],
        title: "Pantheon",
        date: "125 n. Chr. – heute",
        startValue: yearToDecimal(125),
        endValue: new Date().getFullYear(),
        text: "Tempel für alle Götter.",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/Pantheon_Rome_2020.jpg/320px-Pantheon_Rome_2020.jpg",
        symbol: "tempel"
    },
    {
        coords: [41.9009, 12.4833],
        title: "Via del Corso",
        date: "1.–3. Jh. n. Chr.",
        startValue: 0,
        endValue: 300,
        text: "Wichtige Nord-Süd-Achse durch Rom.",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Via_del_Corso_Rome.jpg/320px-Via_del_Corso_Rome.jpg",
        symbol: "strassen"
    },
    {
        coords: [41.9010, 12.4963],
        title: "Thermen des Nero",
        date: "1. Jh. n. Chr.",
        startValue: 0,
        endValue: 100,
        text: "Frühe kaiserzeitliche Thermenanlage.",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Rome_Thermae.jpg/320px-Rome_Thermae.jpg",
        symbol: "thermen"
    },
    {
        coords: [41.89508, 12.47675],
        title: "Katzenasyl Torre Argentina",
        date: "1980 – heute",
        startValue: yearToDecimal(1980),
        endValue: new Date().getFullYear(),
        text: "Unsere Katzis.",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/de/Colosseo_2020.jpg/320px-Colosseo_2020.jpg",
        symbol: "kaiserzeit"
    },
    {
        coords: [41.8922, 12.4790],
        title: "Theater des Marcellus",
        date: "13 v. Chr. – heute",
        startValue: yearToDecimal(-13),
        endValue: new Date().getFullYear(),
        text: "Theaterbau aus der späten Republik.",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Teatro_di_Marcello_Roma.jpg/320px-Teatro_di_Marcello_Roma.jpg",
        symbol: "republik"
    },
    {
        coords: [41.8986, 12.4768],
        title: "Engelsburg",
        date: "139 n. Chr. – heute",
        startValue: yearToDecimal(139),
        endValue: new Date().getFullYear(),
        text: "Mausoleum, später Festung und Papstresidenz.",
        img: "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5f/Castel_Sant%27Angelo_Rome.jpg/320px-Castel_Sant%27Angelo_Rome.jpg",
        symbol: "sonstiges"
    }
];

// ------------------------------------------------------------
// 7. Marker erzeugen
// ------------------------------------------------------------
let markers = [];

points.forEach(p => {
    const marker = L.marker(p.coords, { icon: icons[p.symbol] });

    const box = `
        <div class="info-box">
            <div class="info-title">${p.title}</div>
            <div class="info-date">${p.date}</div>
            <img src="${p.img}" width="200"><br>
            ${p.text}
        </div>
    `;

    marker.bindPopup(box);

    const hoverBox = `
        <div style="pointer-events:none;">
            <img src="${p.img}" style="width:140px; border-radius:4px;">
        </div>
    `;

    marker.bindTooltip(hoverBox, {
        permanent: false,
        direction: "top",
        offset: [0, -20],
        opacity: 0.95,
        className: "hover-popup"
    });

    marker.addTo(map);

    markers.push({
        marker,
        symbol: p.symbol,
        startValue: p.startValue,
        endValue: p.endValue
    });
});

// ------------------------------------------------------------
// 8. Papst-Dropdown
// ------------------------------------------------------------
function buildTimeDropdown() {
    const select = document.getElementById("time-filter");
    select.innerHTML = "";

    const optAll = document.createElement("option");
    optAll.value = "all";
    optAll.textContent = "Alle Zeiträume";
    select.appendChild(optAll);

    const sep = document.createElement("option");
    sep.disabled = true;
    sep.textContent = "──── Päpste ────";
    select.appendChild(sep);

    popes.forEach(p => {
        const opt = document.createElement("option");
        opt.value = `${p.start}-${p.end}`;
        opt.textContent = `${p.name} (${p.start}–${p.end})`;
        select.appendChild(opt);
    });
}

buildTimeDropdown();

// ------------------------------------------------------------
// 9. Slider
// ------------------------------------------------------------
function initSlider() {
    const slider = document.getElementById("time-slider");

    slider.min = 0;
    slider.max = new Date().getFullYear();
    slider.value = slider.max;

    document.getElementById("slider-label").textContent = "Jahr: " + slider.value;
}

initSlider();

function getPopesForYear(year) {
    return popes.filter(p => p.start <= year && p.end >= year).slice(0, 3);
}

function applySlider() {
    const year = parseFloat(document.getElementById("time-slider").value);

    const activePopes = getPopesForYear(year);

    let popeText = activePopes.length
        ? activePopes.map(p => p.name).join(", ")
        : "Kein Papst";

    document.getElementById("slider-label").textContent =
        `Jahr: ${year} — Papst: ${popeText}`;

    markers.forEach(obj => {
        const visible = obj.startValue <= year && obj.endValue >= year;

        if (visible) {
            if (!map.hasLayer(obj.marker)) obj.marker.addTo(map);
        } else {
            if (map.hasLayer(obj.marker)) map.removeLayer(obj.marker);
        }
    });
}

document.getElementById("time-slider")
    .addEventListener("input", applySlider);

// ------------------------------------------------------------
// 10. Admin-Modus
// ------------------------------------------------------------
const adminToggle = document.getElementById('admin-mode');

map.on('click', function(e) {
    if (!adminToggle.checked) return;

    const lat = e.latlng.lat.toFixed(5);
    const lng = e.latlng.lng.toFixed(5);

    const example = `
{
    coords: [${lat}, ${lng}],
    title: "NEUER TITEL",
    date: "DATUM / ZEITSPANNE",
    startValue: yearToDecimal(1980),
    endValue: new Date().getFullYear(),
    text: "Freitext.",
    img: "BILD-URL",
    symbol: "tempel"
}
    `.trim();

    L.marker([lat, lng]).addTo(map)
        .bindPopup(
            "<b>Neuer Marker gesetzt</b><br><br>" +
            `<textarea style='width:100%;height:220px;'>${example}</textarea>`
        )
        .openPopup();
});
</script>
</body>
</html>
